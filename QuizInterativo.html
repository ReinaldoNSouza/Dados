<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Quiz Interativo</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f8;
      margin: 40px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    .box {
      background: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      padding: 20px;
      border-radius: 12px;
    }

    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      margin: 6px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2980b9;
    }

    #feedbackBox {
      font-weight: bold;
      font-size: 18px;
      color: #555;
      text-align: center;
    }

    #reviewBox {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Quiz Interativo</h1>

  <div class="box" id="questionBox"><strong>Pergunta:</strong> <span id="questionText"></span></div>
  <div class="box" id="optionsBox"><strong>Alternativas:</strong> <div id="options"></div></div>
  <div class="box" id="feedbackBox"></div>
  <div class="box">
    <button onclick="previousQuestion()">‚¨ÖÔ∏è Anterior</button>
    <button onclick="nextQuestion()">‚û°Ô∏è Pr√≥xima</button>
    <button onclick="showReview()">üìã Revisar Erradas</button>
  </div>
  <div class="box">
    <strong>Estat√≠sticas:</strong><br>
    Respondidas: <span id="answered">0</span><br>
    Certas: <span id="correct">0</span><br>
    Erradas: <span id="wrong">0</span>
  </div>
  <div class="box" id="reviewBox">
    <strong>Perguntas Erradas:</strong>
    <ul id="reviewList"></ul>
  </div>

  <script>
    let allQuestions = [];
    let activeQuestions = [];
    let history = [];
    let currentIndex = 0;
    let correct = 0, wrong = 0;
    const questionStats = new Map();
    const wrongQuestions = [];

    function shuffleArray(arr) {
      return arr.map(value => ({ value, sort: Math.random() }))
                .sort((a, b) => a.sort - b.sort)
                .map(({ value }) => value);
    }

    async function loadExternalQuestions() {
      try {
        const response = await fetch('perguntas.json');
        const rawData = await response.json();

        // Adapta os dados para o formato esperado
        const data = rawData.map(q => ({
          text: q.pergunta,
          options: q.opcoes,
          correctIndex: q.correta,
          feedback: q.opcoes.map((opt, i) =>
            i === q.correta ? "‚úÖ Correto!" : "‚ùå Incorreto."
          )
        }));

        allQuestions = shuffleArray(data);
        activeQuestions = [...allQuestions];
        currentIndex = 0;
        history = [];
        correct = 0;
        wrong = 0;
        questionStats.clear();
        loadQuestion();
      } catch (error) {
        console.error("Erro ao carregar perguntas:", error);
        document.getElementById("questionText").innerText = "Erro ao carregar perguntas.";
      }
    }

    function startQuiz() {
      loadExternalQuestions();
    }

    function loadQuestion() {
      if (currentIndex < 0 || currentIndex >= activeQuestions.length) return;

      const q = activeQuestions[currentIndex];
      document.getElementById("questionText").innerText = q.text;
      document.getElementById("options").innerHTML = "";
      document.getElementById("feedbackBox").innerText = "";

      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.innerText = opt;
        btn.onclick = () => handleAnswer(i);
        document.getElementById("options").appendChild(btn);
      });
    }

    function handleAnswer(selectedIndex) {
      const q = activeQuestions[currentIndex];
      const feedback = q.feedback[selectedIndex];
      document.getElementById("feedbackBox").innerText = feedback;

      const id = q.text;
      const stats = questionStats.get(id) || { correctCount: 0 };

      if (selectedIndex === q.correctIndex) {
        correct++;
        stats.correctCount++;
        if (stats.correctCount < 3) {
          for (let i = 0; i < 2; i++) {
            let insertPos = Math.min(activeQuestions.length, currentIndex + 6 + i);
            activeQuestions.splice(insertPos, 0, q);
          }
        } else {
          activeQuestions = activeQuestions.filter(item => item.text !== id);
        }
      } else {
        wrong++;
        if (!wrongQuestions.includes(q)) wrongQuestions.push(q);
      }

      questionStats.set(id, stats);

      document.getElementById("answered").innerText = history.length + 1;
      document.getElementById("correct").innerText = correct;
      document.getElementById("wrong").innerText = wrong;

      history.push(currentIndex);
      saveProgress();
      nextQuestion();
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex >= activeQuestions.length) {
        document.getElementById("questionText").innerText = "Fim do quiz!";
        document.getElementById("options").innerHTML = "";
        document.getElementById("feedbackBox").innerText = "";
      } else {
        loadQuestion();
      }
    }

    function previousQuestion() {
      if (history.length > 0) {
        currentIndex = history.pop();
        loadQuestion();
      }
    }

    function saveProgress() {
      localStorage.setItem("wrongQuestions", JSON.stringify(wrongQuestions));
    }

    function showReview() {
      const reviewBox = document.getElementById("reviewBox");
      const reviewList = document.getElementById("reviewList");
      reviewList.innerHTML = "";

      const saved = JSON.parse(localStorage.getItem("wrongQuestions") || "[]");
      if (saved.length === 0) {
        reviewList.innerHTML = "<li>Nenhuma pergunta errada salva.</li>";
      } else {
        saved.forEach(q => {
          const li = document.createElement("li");
          li.innerText = q.text;
          reviewList.appendChild(li);
        });
      }

      reviewBox.style.display = "block";
    }

    startQuiz();
  </script>

</body>
</html>
